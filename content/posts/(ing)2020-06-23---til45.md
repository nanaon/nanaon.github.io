---
title: django - 장고 쿼리 이론 및 실습 (작성 중)
date: "2020-06-23T16:28:32.160Z"
template: "post"
draft: true
slug: "til45"
category: "django"
tags:
  - "til"
  - "django"
  - "wecode"
description: ""
socialImage: "/naon.png"
---

Foreign-key로 엮은 테이블 간 데이터를 불러올 때 데이터베이스에서 직접 꺼내오지 않고도 불어올 수 있는 방법이 있다. 쿼리 수를 줄여줌으로서 더 빠른 연산을 할 수 있는 것이다.

### select_related()
일대일 필드 또는 foreign key를 걸어놓은 관계에서 사용할 수 있다. select_related()가 걸려 있는 변수를 선언한 순간 sql 상에서 테이블 조인이 일어나 DB hit를 하지 않고 연결된 테이블의 데이터를 읽어올 수 있다. (화살표 방향으로 찾기 = 정참조)

`select_related()`를 사용하려면 변수에 할당해주고 해야함
변수를 실행하는 순간 테이블끼리 left join.

### prefetch_related()
`select_related()`는 일대일 또는 ForeignKey로 연결된 필드끼리만 사용할 수 있다면, `prefetch_related()`는 관련 테이블을 모두 쿼리해와서 python에서 처리하기 때문에 아무 관계에서나 다 쓸 수 있다.

피자 - 토핑 관계를 생각해보면, 내가 콤비네이션 피자 이름을 알고 있다면 `select_related()`로 찾을 수 있다. 만약 토핑 정보만 알고 특정 토핑이 안 들어간(혹은 들어간) 피자를 찾고 싶다면 `prefetch_related()`를 쓰면 된다. (화살표 역방향으로 찾기 = 역참조)


user_id로 orders 테이블 데이터를 가져오기

`Order.objects.select_related('user').get(id=1)`


`Order.objects.prefetch_related('cart_set__product_color__product__material')[0].cart_set.all()`

`<QuerySet [<Cart: Cart object (2)>]>`

`Order.objects.prefetch_related('product_color__product__material')[0].user.name`

오더 테이블 첫 번째 유저 이름 출력