{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/til49","result":{"data":{"markdownRemark":{"id":"4cac6828-de87-55a9-a867-fcc6e1858f5b","html":"<p>팀 프로젝트 하면서 작성했던 db 업로더 중 기억하고 싶은 코드를 남긴다. 팀원 셋이서 각자 파트를 나눠 업로더를 짰기 때문에 코드 재사용을 염두에 두고 작성했다. 각 테이블별로 함수를 만들어서 테스트가 용이했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># ...코드 전략...</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">new_product</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>CSV_PATH_NO_DUPLICATED<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> in_file<span class=\"token punctuation\">:</span>\n    data_reader <span class=\"token operator\">=</span> csv<span class=\"token punctuation\">.</span>reader<span class=\"token punctuation\">(</span>in_file<span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>data_reader<span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># 상품명 중복을 없애기 위해 조건을 걸고 빈 리스트에 넣었다.</span>\n    <span class=\"token comment\"># distinct() 함수를 쓰면 더 간단하지 않을까.</span>\n    product_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">for</span> row <span class=\"token keyword\">in</span> data_reader<span class=\"token punctuation\">:</span>\n        product_name <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">if</span> product_name <span class=\"token keyword\">in</span> product_list<span class=\"token punctuation\">:</span>\n          <span class=\"token keyword\">pass</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n          product_list<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>product_name<span class=\"token punctuation\">)</span>\n          price_name <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span>\n          material_name <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span>\n          material_id <span class=\"token operator\">=</span> Material<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> material_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span>\n          country_name <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">11</span><span class=\"token punctuation\">]</span>\n          country_id <span class=\"token operator\">=</span> Country<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> country_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span>\n          Product<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> product_name<span class=\"token punctuation\">,</span> price <span class=\"token operator\">=</span> price_name<span class=\"token punctuation\">,</span> material_id <span class=\"token operator\">=</span> material_id<span class=\"token punctuation\">,</span> country_id <span class=\"token operator\">=</span> country_id<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">new_product_colors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>CSV_PATH_NO_DUPLICATED<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> in_file<span class=\"token punctuation\">:</span>\n    data_reader <span class=\"token operator\">=</span> csv<span class=\"token punctuation\">.</span>reader<span class=\"token punctuation\">(</span>in_file<span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>data_reader<span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> row <span class=\"token keyword\">in</span> data_reader<span class=\"token punctuation\">:</span>\n      product_number <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n      <span class=\"token comment\"># color_id</span>\n      color_name <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n      color_id <span class=\"token operator\">=</span> Color<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span>color_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span>\n      <span class=\"token comment\"># product_id</span>\n      product_name <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\n      product_id <span class=\"token operator\">=</span> Product<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span>product_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span>\n      <span class=\"token comment\"># discount_price</span>\n      <span class=\"token comment\"># 할인 상품이 아닐 경우 원가를 넣어준다.</span>\n      <span class=\"token keyword\">if</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">:</span>\n        discount_price <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        discount_price <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span> \n      <span class=\"token comment\"># detail_thumbnail 추가</span>\n      detail_thumbnail <span class=\"token operator\">=</span> row<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n\n      ProductColor<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>product_number<span class=\"token operator\">=</span>product_number<span class=\"token punctuation\">,</span> color_id<span class=\"token operator\">=</span>color_id<span class=\"token punctuation\">,</span> product_id<span class=\"token operator\">=</span>product_id<span class=\"token punctuation\">,</span> discount_price<span class=\"token operator\">=</span>discount_price<span class=\"token punctuation\">,</span> detail_thumbnail<span class=\"token operator\">=</span>detail_thumbnail<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># products 테이블 추가</span>\nnew_product<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># product_colors 테이블 추가</span>\nnew_product_colors<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>     </code></pre></div>","fields":{"slug":"/posts/til49","tagSlugs":["/tag/til/","/tag/python/","/tag/mysql/"]},"frontmatter":{"date":"2020-06-28T22:34:32.160Z","description":"크롤링한 데이터를 데이터베이스에 넣기","tags":["til","python","mysql"],"title":"Python - 파이썬 명령어로 csv 파일 데이터베이스에 넣기","socialImage":"/naon.png"}}},"pageContext":{"slug":"/posts/til49"}}}